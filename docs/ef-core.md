# Entity Framework Core na solução ServiceOrders

Este documento resume como o Entity Framework Core (EF Core) é utilizado na solução **ServiceOrders** e onde encontrar os principais pontos de integração.

- **Contexto**: o `ServiceOrdersDbContext` herda de `DbContext` e expõe coleções (`DbSet`) para o novo domínio de Ordens de Serviço: ordens (`OrdersOfService`), templates e itens de checklist, respostas e fotos, além de usuários, metas mensais e tokens de redefinição. As configurações são aplicadas automaticamente via `ApplyConfigurationsFromAssembly`. 【F:src/ServiceOrders.Infrastructure/Persistence/ServiceOrdersDbContext.cs†L1-L33】
- **Configurações de entidade**: cada agregado possui uma classe de configuração em `Persistence/Configurations`, onde são definidos tamanhos máximos, conversões de enums e relacionamentos (por exemplo, `OrderOfService` → `ChecklistResponse` e `ChecklistResponseItem` → `PhotoAttachment`). 【F:src/ServiceOrders.Infrastructure/Persistence/Configurations/OrderOfServiceConfiguration.cs†L1-L36】【F:src/ServiceOrders.Infrastructure/Persistence/Configurations/ChecklistResponseItemConfiguration.cs†L1-L27】【F:src/ServiceOrders.Infrastructure/Persistence/Configurations/UserConfiguration.cs†L1-L35】
- **Injeção de dependência**: o `DependencyInjection` da infraestrutura registra o `ServiceOrdersDbContext` com suporte a SQL Server ou ao provedor **InMemory**. Caso `Database:Provider` seja definido como `SqlServer`, é obrigatória a connection string; caso contrário, um banco em memória chamado `ServiceOrdersDb` é usado por padrão. 【F:src/ServiceOrders.Infrastructure/DependencyInjection.cs†L51-L81】
- **Repositórios**: os repositórios concretos (`OrderOfServiceRepository`, `ChecklistTemplateRepository`, `ChecklistResponseRepository`, `PhotoAttachmentRepository`, `MonthlyTargetRepository`, `UserRepository`, `PasswordResetTokenRepository`) encapsulam o acesso ao contexto e usam consultas LINQ (`AsNoTracking`, `Include`) e `SaveChangesAsync`. 【F:src/ServiceOrders.Infrastructure/Repositories/OrderOfServiceRepository.cs†L1-L63】【F:src/ServiceOrders.Infrastructure/Repositories/ChecklistTemplateRepository.cs†L1-L45】

Com essa configuração, o EF Core permanece isolado na camada de infraestrutura, mantendo o domínio e a aplicação livres de dependências diretas do provedor de dados.
